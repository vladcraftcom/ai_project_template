## Оценки (0–5)
| Metric      | Score | Почему |
|-------------|-------|--------|
| A-TaskSpec  | 4.6   | Есть роль, вход/выход, DoD, процесс и формат ответа. Несколько опечаток в брифе и дублированный пункт «6)». |
| B-Prompts   | 4.4   | Соблюден цикл вопросы→план→код→тесты; учтены крайние случаи, логирование, README. Можно точнее формализовать CSV-параметры по умолчанию. |
| C-Code      | 4.2   | Реализованы CLI, pandas/streaming, обработка дат, логирование, коды ошибок; код чистый. Можно улучшить унификацию дат и обработку локалей. |
| D-Repro     | 4.8   | Команда запуска воспроизводима, есть тесты, run_log, артефакты; потоковая конверсия проверена на 10k строк. |

## Критичные риски
- Отсутствует явная спецификация локалей и форматирования чисел/дат для разных регионов.
- Нет проверки дубликатов и схемы полей (валидации) — риск тихих ошибок при изменении формата источника.
- Параметры CSV (разделитель, quoting) заданы дефолтами, но не закреплены в DoD → риск несовместимости с потребителями.
- Автоопределение дат в pandas может вести к неоднозначным преобразованиям без явной схемы.
- Нет интеграционных тестов на несколько листов/нестандартные заголовки/пустые строки сверху.

## Чек-лист правок (≤10)
1. Зафиксировать дефолтные CSV-параметры в `cursor_prompt.md` и `README.md` (разделитель, кодировка, line endings, quoting).
2. Добавить флаг `--schema path.json` для опциональной валидации полей (обязательные, типы, enum).
3. Добавить флаг `--dedupe key` для дедупликации по колонке(ам) перед записью.
4. Уточнить и унифицировать конвертацию дат: явная обработка Excel-сериалов и `datetime` в обоих режимах.
5. Расширить тесты: кейсы с несколькими листами, заголовки не на первой строке, пустые строки в начале.
6. Логировать итоговые параметры CSV и количество пропусков/некорректных значений (basic data quality report).
7. Поддержать `--line-ending CRLF` и проверить в тестах на Windows-совместимость (проверка `\r\n`).
8. Добавить `--decimal ,` режим с e2e-тестом (если потребуется локализация).
9. В `run_log.txt` фиксировать версии зависимостей (`pandas`, `openpyxl`).
10. Подготовить пример схемы `schema_example.json`.

## Улучшенная версия промпта для Cursor
```md
# Cursor Prompt Skeleton (универсальный)

**Системная роль:**  
Ты — Senior Automation Engineer (Python 3.10). Пиши код для запуска новичком, но инженерно грамотно. Следуй циклу: вопросы → план → тесты → код. Используй бесплатные библиотеки. Стиль: функции, аннотации типов, логирование ошибок, понятные сообщения, докстринги. Используй `.venv`.

**Контекст задачи:**  
Inputs:  
- excel_to_csv/data_in/shopify_orders_20250918_202022.xlsx  
Output:  
- excel_to_csv/data_out/shopify_orders_20250918_202022.csv  
Constraints:  
- Python 3.10; разрешены `pandas`, `openpyxl`; без проприетарных.  
EdgeCases:  
- Пустые строки/листы, большие файлы, Excel-сериалы дат, скрытые колонки, отсутствующие заголовки.  
DoD:  
- Скрипт запускается одной командой, завершает работу без ошибок, логирует в `logs/`, есть README и тесты.

**Требования к процессу:**  
0) Сначала задай уточняющие вопросы → `questions.md`.  
1) Сформируй детальный план и тесты → `plan.md` (после каждого шага логируй в `manifest.ai.md`).  
2) Ознакомься с входными данными и структурой (`/code`, `/data_in`, `/data_out`, `/logs`) и при необходимости уточни план.  
3) Сгенерируй интерфейсы и тесты типов. Затем реализуй сущности. Запусти тесты до зелёного статуса.  
4) Учти крайние случаи из контекста. Добавь логирование в `logs/`.  
5) Подготовь README (установка, запуск, примеры). Напиши e2e-тесты.

**CSV дефолты (закрепить):**  
- delimiter=","; encoding="utf-8"; line_ending=LF; quoting=minimal; dates=ISO 8601 UTC.

**Формат ответа (обязательно):**  
- ## План  
- ## Структура проекта  
- ## Код (с путями)  
- ## Как запустить  
- ## Тесты/Проверки  
- ## README (черновик)
```

## Следующие шаги
- Зафиксировать CSV-дефолты в брифе и README.
- Добавить схему валидации и дедупликацию как опциональные флаги.
- Расширить тесты (мульти-листы, заголовки не на первой строке, пустые префиксные строки).
- Логировать версии зависимостей и итоговые параметры конвертации в run_log.
