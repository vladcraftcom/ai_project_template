# Уточняющие вопросы по задаче Excel → CSV

## 1) Источник данных (Excel)
- Какой лист использовать: имя/индекс? Если несколько листов — какие правила выбора?
- В какой строке заголовки? Есть ли пустые строки/колонки до заголовков?
- Есть ли объединённые ячейки, формулы (нужны значения), скрытые строки/колонки?
- Какие типы встречаются: даты, валюты, проценты, булевы? Особые форматы Shopify?
- Каков ожидаемый максимальный размер файла (строки/листы)?

> лист в документе только один, его и используем.

## 2) Выходной CSV: формат
- Разделитель: `,` или `;` или табуляция (`\t`)?
- Кодировка: `utf-8` или `utf-8-sig` (BOM)? Конец строк: `LF` или `CRLF`?
- Кавычки: все поля или минимально необходимые (quoting)? Символ экранирования?
- Десятичный разделитель: точка или запятая? Нужна ли локализация чисел?
- Формат дат/времени: ISO 8601 (`YYYY-MM-DDTHH:MM:SSZ`) или иной? Таймзона?
- Имя и путь файла вывода: строго `excel_to_csv/data_out/<имя>.csv` или настраиваемо?

## 3) Трансформации данных
- Схема колонок: оставить все как есть или выбрать подмножество? Переименования/порядок?
- Нормализация типов: даты → ISO, числа → десятичная точка, trimming пробелов?
- Фильтрация строк: по статусам заказов, диапазону дат, marketplace и т.п.?
- Дедупликация: по какому ключу (например, `Order ID`)? Какое правило оставления дубликатов?
- Сортировка: по какому полю и направлению?
- Заполнение пропусков: чем заполнять `NaN`/пустые значения?

## 4) Валидации качества
- Обязательные поля (список)? Что делать при их отсутствии/пустоте?
- Уникальность по какому полю требуется? Что делать при нарушении?
- Допустимые значения (enum) для отдельных колонок? Диапазоны для дат/сумм?
- Прерывать процесс при ошибках или писать отчёт и продолжать? Где хранить отчёт?

## 5) Крайние случаи
- Пустой файл или пустой лист — как обрабатывать?
- Неизвестные/лишние колонки — игнорировать, предупреждать, падать?
- Очень большие файлы — допустим ли стриминговый режим без загрузки всего в память?
- Некорректные типы в ячейках (дата как текст и т.д.) — правила коэрции?

## 6) Производительность и библиотеки
- Разрешены ли `pandas` и `openpyxl`? Приоритет «бесплатное и открытое ПО» подтверждаем.
- Предпочтителен ли `xlsx2csv` (стриминг) вместо `pandas` для больших файлов?
- Ограничения по времени выполнения/памяти?

## 7) CLI и UX запуска
- Единая команда запуска: какие флаги нужны (`--input`, `--sheet`, `--delimiter`, `--encoding`, `--out`)?
- Автоопределение входного файла по маске `shopify_orders_*.xlsx`, если `--input` не указан?
- Поведение при существующем выходном файле: перезаписывать, добавлять суффикс, требовать `--force`?
- Нужна ли поддержка Windows, или достаточно macOS/Linux?
- Язык пользовательских сообщений: русский?

## 8) Логирование и диагностирование
- Уровень логов по умолчанию: `INFO` или `DEBUG`? Нужны ли подробные трассировки?
- Формат логов: текст/JSON? Имя файла и ротация (один файл на запуск в `logs/`)?
- Требования к шагам логирования в `manifest.ai.md`: что фиксировать после каждого шага?

## 9) Ошибки и коды выхода
- Требуются ли конкретные коды выхода для типовых ошибок (нет файла, нет листа, невалидная схема)?
- Порог фатальности: при каких ошибках немедленно прерывать конвертацию?

## 10) Тестирование
- Нужны ли «эталонные» файлы (golden) для сравнения вывода побайтно/построчно?
- Где хранить тестовые штучные Excel и ожидаемые CSV? (например, `excel_to_csv/data_in/tests`)
- Ограничения на размер тестовых файлов? Покрывать ли большие объёмы synthetic-генерацией?

## 11) Конфиденциальность и PII
- Содержатся ли PII (e-mail, телефоны, адреса)? Нужно ли маскирование или исключение столбцов?
- Политика хранения логов: можно ли писать пример значений в логи, или только агрегаты?

## 12) Даты и часовые пояса
- Какой целевой часовой пояс для дат/времени? Конвертировать ли из UTC?
- Нужно ли выводить отдельно дату и время или одним полем с таймзоной?

## 13) Расширение на будущее
- Нужна ли поддержка множественных входных файлов с мерджем в один CSV?
- Планируется ли упаковка в отдельную CLI-утилиту (`pipx`) в дальнейшем?

## 14) Дефолты, если вы не ответите
Если явных указаний не будет, возьмём по умолчанию:
- Разделитель: `,`; кодировка: `utf-8`; окончания строк: `LF`; quoting: минимальный.
- Даты: ISO 8601 в UTC; числа: десятичная точка; trimming пробелов.
- Лист: `Orders`, если есть; иначе — первый лист.
- Схема: все колонки как есть, без переименований и фильтров; без дедупликации.
- Ошибки критичные — прерывать; отчёты и логи писать в `logs/`.

